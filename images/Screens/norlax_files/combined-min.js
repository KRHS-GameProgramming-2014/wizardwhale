function Sarissa(){}function add_sheet(a,b){if(document.createStyleSheet)document.createStyleSheet(a);else{var c=document.createElement("link");c.rel="stylesheet",c.type="text/css",c.media=b||"all",c.href=a,document.getElementsByTagName("head")[0].appendChild(c)}}function remove_css(a,b){return get_css(a,b,!0)}function get_sheet_num(a){if(!document.styleSheets)return!1;for(var b=0;b<document.styleSheets.length;b++)if(document.styleSheets[b].href&&document.styleSheets[b].href.toString().match(a))return b;return!1}function add_css(a,b){a=a.toLowerCase(),b=b||0;if(!document.styleSheets||get_css(a,b))return!1;document.styleSheets[b].insertRule?document.styleSheets[b].insertRule(a+" { }",0):document.styleSheets[b].addRule(a,null,0);return get_css(a,b)}function get_css(a,b,c){if(!document.styleSheets)return!1;a=a.toLowerCase(),b=b||0;for(var d=b;d<document.styleSheets.length;d++){var e=document.styleSheets[d];css_rules=document.styleSheets[d].cssRules||document.styleSheets[d].rules;if(!css_rules)continue;var f=0;do{if(css_rules.length&&f>css_rules.length+5)return!1;if(css_rules[f].selectorText&&css_rules[f].selectorText.toLowerCase()==a){if(c==!0){document.styleSheets[d].removeRule&&document.styleSheets[d].removeRule(f),document.styleSheets[d].deleteRule&&document.styleSheets[d].deleteRule(f);return!0}return css_rules[f]}}while(css_rules[++f])}return!1}(function(a){function b(){typeof b.inst=="undefined"&&(b.cntr=0,b.inst={},b.drag_drop={isdown:!1,drag_node:!1,drag_help:!1,init_x:!1,init_y:!1,moving:!1,origin_tree:!1,marker:!1,move_type:!1,ref_node:!1,appended:!1,foreign:!1,droppable:[],open_time:!1,scroll_time:!1},b.mousedown=function(c){var d=a(c.target);if(b.drag_drop.droppable.length&&d.is("."+b.drag_drop.droppable.join(", ."))){b.drag_drop.drag_help=a("<div id='jstree-dragged' class='tree tree-default'><ul><li class='last dragged foreign "+c.target.className+"'><a href='#'>"+d.text()+"</a></li></ul></div>"),b.drag_drop.drag_node=b.drag_drop.drag_help.find("li:eq(0)"),b.drag_drop.isdown=!0,b.drag_drop.foreign=d,d.blur(),c.preventDefault(),c.stopPropagation();return!1}c.stopPropagation();return!0},b.mouseup=function(c){var d=b.drag_drop;d.open_time&&clearTimeout(d.open_time),d.scroll_time&&clearTimeout(d.scroll_time);if(d.foreign===!1&&d.drag_node&&d.drag_node.size()){d.drag_help.remove();if(d.move_type){var e=b.inst[d.ref_node.parents(".tree:eq(0)").attr("id")];e&&e.moved(d.origin_tree.container.find("li.dragged"),d.ref_node,d.move_type,!1,d.origin_tree.settings.rules.drag_copy=="on"||d.origin_tree.settings.rules.drag_copy=="ctrl"&&c.ctrlKey)}d.move_type=!1,d.ref_node=!1}if(d.drag_node&&d.foreign!==!1){d.drag_help.remove();if(d.move_type){var e=b.inst[d.ref_node.parents(".tree:eq(0)").attr("id")];e&&e.settings.callback.ondrop.call(null,d.foreign.get(0),e.get_node(d.ref_node).get(0),d.move_type,e)}d.foreign=!1,d.move_type=!1,d.ref_node=!1}b.drag_drop.marker.hide(),d.drag_help=!1,d.drag_node=!1,d.isdown=!1,d.init_x=!1,d.init_y=!1,d.moving=!1,d.appended=!1,a("li.dragged").removeClass("dragged"),d.origin_tree=!1,c.preventDefault(),c.stopPropagation();return!1},b.mousemove=function(c){var d=b.drag_drop;if(d.isdown){if(!d.moving&&Math.abs(d.init_x-c.pageX)<5&&Math.abs(d.init_y-c.pageY)<5){c.preventDefault(),c.stopPropagation();return!1}b.drag_drop.moving=!0,d.open_time&&clearTimeout(d.open_time),d.appended||(d.foreign!==!1&&(d.origin_tree=a.tree_focused()),a("body").append(d.drag_help),d.w=d.drag_help.width(),d.appended=!0),d.drag_help.css({left:c.pageX-(d.origin_tree.settings.ui.rtl?d.w:-5),top:c.pageY+15});if(c.target.tagName=="IMG"&&c.target.id=="marker")return!1;var e=a(c.target),f=e.is(".tree")?e:e.parents(".tree:eq(0)");if(f.size()==0||!b.inst[f.attr("id")]){d.scroll_time&&clearTimeout(d.scroll_time),d.drag_help.find("IMG").size()==0&&d.drag_help.find("li:eq(0)").append("<img style='position:absolute; "+(d.origin_tree.settings.ui.rtl?"right":"left")+":4px; top:0px; background:white; padding:2px;' src='"+d.origin_tree.settings.ui.theme_path+"remove.png' />"),d.move_type=!1,d.ref_node=!1,b.drag_drop.marker.hide();return!1}var g=b.inst[f.attr("id")];g.off_height();if(d.foreign===!1&&d.origin_tree.container.get(0)!=g.container.get(0)&&(!d.origin_tree.settings.rules.multitree||!g.settings.rules.multitree)){d.drag_help.find("IMG").size()==0&&d.drag_help.find("li:eq(0)").append("<img style='position:absolute; "+(d.origin_tree.settings.ui.rtl?"right":"left")+":4px; top:0px; background:white; padding:2px;' src='"+d.origin_tree.settings.ui.theme_path+"remove.png' />"),d.move_type=!1,d.ref_node=!1,b.drag_drop.marker.hide();return!1}d.scroll_time&&clearTimeout(d.scroll_time),d.scroll_time=setTimeout(function(){g.scrollCheck(c.pageX,c.pageY)},50);var h=!1,i=f.scrollTop();if(c.target.tagName=="A"){if(e.is("#jstree-dragged"))return!1;g.get_node(c.target).hasClass("closed")&&(d.open_time=setTimeout(function(){g.open_branch(e)},500));var j=e.offset(),k={x:j.left-1,y:c.pageY-j.top};f.children("ul:eq(0)").hasClass("rtl")&&(k.x+=e.width()-8);var l=[];k.y<g.li_height/3+1?l=["before","inside","after"]:k.y>g.li_height*2/3-1?l=["after","inside","before"]:k.y<g.li_height/2?l=["inside","before","after"]:l=["inside","after","before"];var m=!1;a.each(l,function(a,b){if(g.checkMove(d.origin_tree.container.find("li.dragged"),e,b)){h=b,m=!0;return!1}});if(m){switch(h){case"before":k.y=j.top-2,f.children("ul:eq(0)").hasClass("rtl")?b.drag_drop.marker.attr("src",g.settings.ui.theme_path+"marker_rtl.gif").width(40):b.drag_drop.marker.attr("src",g.settings.ui.theme_path+"marker.gif").width(40);break;case"after":k.y=j.top-2+g.li_height,f.children("ul:eq(0)").hasClass("rtl")?b.drag_drop.marker.attr("src",g.settings.ui.theme_path+"marker_rtl.gif").width(40):b.drag_drop.marker.attr("src",g.settings.ui.theme_path+"marker.gif").width(40);break;case"inside":k.x-=2,f.children("ul:eq(0)").hasClass("rtl")&&(k.x+=36),k.y=j.top-2+g.li_height/2,b.drag_drop.marker.attr("src",g.settings.ui.theme_path+"plus.gif").width(11)}d.move_type=h,d.ref_node=a(c.target),d.drag_help.find("IMG").remove(),b.drag_drop.marker.css({left:k.x,top:k.y}).show()}}if((e.is(".tree")||e.is("ul"))&&e.find("li:eq(0)").size()==0){var j=e.offset();d.move_type="inside",d.ref_node=f.children("ul:eq(0)"),d.drag_help.find("IMG").remove(),b.drag_drop.marker.attr("src",g.settings.ui.theme_path+"plus.gif").width(11),b.drag_drop.marker.css({left:j.left+(f.children("ul:eq(0)").hasClass("rtl")?f.width()-10:10),top:j.top+15}).show()}else if(c.target.tagName!="A"||!m)d.drag_help.find("IMG").size()==0&&d.drag_help.find("li:eq(0)").append("<img style='position:absolute; "+(d.origin_tree.settings.ui.rtl?"right":"left")+":4px; top:0px; background:white; padding:2px;' src='"+d.origin_tree.settings.ui.theme_path+"remove.png' />"),d.move_type=!1,d.ref_node=!1,b.drag_drop.marker.hide();c.preventDefault(),c.stopPropagation();return!1}return!0});return{cntr:++b.cntr,settings:{data:{type:"predefined",method:"GET",async:!1,async_data:function(b,c){return{id:a(b).attr("id")||0}},url:!1,json:!1,xml:!1},selected:!1,opened:[],languages:[],path:!1,cookies:!1,ui:{dots:!0,rtl:!1,animation:0,hover_mode:!0,scroll_spd:4,theme_path:!1,theme_name:"default",context:[{id:"create",label:"Create",icon:"create.png",visible:function(a,b){if(a.length!=1)return!1;return b.check("creatable",a)},action:function(a,b){b.create(!1,b.get_node(a[0]))}},"separator",{id:"rename",label:"Rename",icon:"rename.png",visible:function(a,b){if(a.length!=1)return!1;return b.check("renameable",a)},action:function(a,b){b.rename(a)}},{id:"delete",label:"Delete",icon:"remove.png",visible:function(b,c){var d=!0;a.each(b,function(){c.check("deletable",this)==!1&&(d=!1);return!1});return d},action:function(b,c){a.each(b,function(){c.remove(this)})}}]},rules:{multiple:!1,metadata:!1,type_attr:"rel",multitree:!1,createat:"bottom",use_inline:!1,clickable:"all",renameable:"all",deletable:"all",creatable:"all",draggable:"none",dragrules:"all",drag_copy:!1,droppable:[],drag_button:"left"},lang:{new_node:"New folder",loading:"Loading ..."},callback:{beforechange:function(a,b){return!0},beforeopen:function(a,b){return!0},beforeclose:function(a,b){return!0},beforemove:function(a,b,c,d){return!0},beforecreate:function(a,b,c,d){return!0},beforerename:function(a,b,c){return!0},beforedelete:function(a,b){return!0},onJSONdata:function(a,b){return a},onselect:function(a,b){},ondeselect:function(a,b){},onchange:function(a,b){},onrename:function(a,b,c,d){},onmove:function(a,b,c,d,e){},oncopy:function(a,b,c,d,e){},oncreate:function(a,b,c,d,e){},ondelete:function(a,b,c){},onopen:function(a,b){},onopen_all:function(a){},onclose:function(a,b){},error:function(a,b){},ondblclk:function(a,b){b.toggle_branch.call(b,a),b.select_branch.call(b,a)},onrgtclk:function(a,b,c){},onload:function(a){},onfocus:function(a){},ondrop:function(a,b,c,d){}}},init:function(c,d){var e=this;this.container=a(c);if(this.container.size==0)alert("Invalid container node!");else{b.inst[this.cntr]=this,this.container.attr("id")||this.container.attr("id","jstree_"+this.cntr),b.inst[this.container.attr("id")]=b.inst[this.cntr],b.focused=this.cntr;var f=a.extend({},d);f&&f.cookies&&(this.settings.cookies=a.extend({},this.settings.cookies,f.cookies),delete f.cookies,this.settings.cookies.opts||(this.settings.cookies.opts={})),f&&f.callback&&(this.settings.callback=a.extend({},this.settings.callback,f.callback),delete f.callback),f&&f.data&&(this.settings.data=a.extend({},this.settings.data,f.data),delete f.data),f&&f.ui&&(this.settings.ui=a.extend({},this.settings.ui,f.ui),delete f.ui),f&&f.rules&&(this.settings.rules=a.extend({},this.settings.rules,f.rules),delete f.rules),f&&f.lang&&(this.settings.lang=a.extend({},this.settings.lang,f.lang),delete f.lang),this.settings=a.extend({},this.settings,f),this.settings.path==!1?(this.path="",a("script").each(function(){this.src.toString().match(/tree_component.*?js$/)&&(e.path=this.src.toString().replace(/tree_component.*?js$/,""))})):this.path=this.settings.path,this.current_lang=this.settings.languages&&this.settings.languages.length?this.settings.languages[0]:!1;if(this.settings.languages&&this.settings.languages.length){this.sn=get_sheet_num("tree_component.css"),this.sn===!1&&document.styleSheets.length&&(this.sn=document.styleSheets.length);var g=!1,h=this.container.attr("id")?"#"+this.container.attr("id"):".tree";for(var i=0;i<this.settings.languages.length;i++)g=add_css(h+" ."+this.settings.languages[i],this.sn),g!==!1&&(this.settings.languages[i]==this.current_lang?g.style.display="":g.style.display="none")}if(this.settings.rules.droppable.length){for(var j in this.settings.rules.droppable){if(typeof this.settings.rules.droppable[j]=="function")continue;b.drag_drop.droppable.push(this.settings.rules.droppable[j])}b.drag_drop.droppable=a.unique(b.drag_drop.droppable)}this.settings.ui.theme_path===!1&&(this.settings.ui.theme_path=this.path+"themes/"),this.theme=this.settings.ui.theme_path,e.settings.ui.theme_name&&(this.theme+=e.settings.ui.theme_name+"/",e.settings.ui.theme_name!="themeroller"&&!b.def_style&&(add_sheet(e.settings.ui.theme_path+"default/style.css"),b.def_style=!0),add_sheet(e.theme+"style.css")),this.container.addClass("tree"),e.settings.ui.theme_name!="themeroller"&&this.container.addClass("tree-default"),this.settings.ui.theme_name&&this.settings.ui.theme_name!="default"&&this.container.addClass("tree-"+e.settings.ui.theme_name),this.settings.ui.theme_name=="themeroller"&&this.container.addClass("ui-widget ui-widget-content"),this.settings.rules.multiple&&(this.selected_arr=[]),this.offset=!1,this.context_menu(),this.hovered=!1,this.locked=!1;if(this.settings.rules.draggable!="none"&&b.drag_drop.marker===!1){var e=this;b.drag_drop.marker=a("<img>").attr({id:"marker",src:e.settings.ui.theme_path+"marker.gif"}).css({height:"5px",width:"40px",display:"block",position:"absolute",left:"30px",top:"30px",zIndex:"1000"}).hide().appendTo("body")}this.refresh(),this.attachEvents(),this.focus()}},off_height:function(){if(this.offset===!1){this.container.css({position:"relative"}),this.offset=this.container.offset();var b=0;b=parseInt(a.curCSS(this.container.get(0),"paddingTop",!0),10),b&&(this.offset.top+=b),b=parseInt(a.curCSS(this.container.get(0),"borderTopWidth",!0),10),b&&(this.offset.top+=b),this.container.css({position:""})}if(!this.li_height){var b=this.container.find("ul li.closed, ul li.leaf").eq(0);this.li_height=b.height(),b.children("ul:eq(0)").size()&&(this.li_height-=b.children("ul:eq(0)").height()),this.li_height||(this.li_height=18)}},context_menu:function(){this.context=!1;if(this.settings.ui.context!=!1){var b='<div class="tree-context tree-default-context tree-'+this.settings.ui.theme_name+'-context">';for(var c in this.settings.ui.context){if(typeof this.settings.ui.context[c]=="function")continue;if(this.settings.ui.context[c]=="separator"){b+="<span class='separator'>&nbsp;</span>";continue}var d="";this.settings.ui.context[c].icon&&(d="background-image:url('"+(this.settings.ui.context[c].icon.indexOf("/")==-1?this.theme+this.settings.ui.context[c].icon:this.settings.ui.context[c].icon)+"');"),b+='<a rel="'+this.settings.ui.context[c].id+'" href="#" style="'+d+'">'+this.settings.ui.context[c].label+"</a>"}b+="</div>",this.context=a(b),this.context.hide(),this.context.append=!1}},refresh:function(b){if(this.locked)return this.error("LOCKED");var c=this;this.is_partial_refresh=b?!0:!1,this.opened=[];if(this.settings.cookies&&a.cookie(this.settings.cookies.prefix+"_open")){var d=a.cookie(this.settings.cookies.prefix+"_open"),e=d.split(",");a.each(e,function(){this.replace(/^#/,"").length>0&&c.opened.push("#"+this.replace(/^#/,""))}),this.settings.opened=!1}else this.settings.opened!=!1?(a.each(this.settings.opened,function(a,b){this.replace(/^#/,"").length>0&&c.opened.push("#"+this.replace(/^#/,""))}),this.settings.opened=!1):this.container.find("li.open").each(function(a){this.id&&c.opened.push("#"+this.id)});if(this.selected)this.settings.selected=[],b?a(b).find("li:has(a.clicked)").each(function(){$this=a(this),$this.attr("id")&&c.settings.selected.push("#"+$this.attr("id"))}):this.selected_arr?a.each(this.selected_arr,function(){this.attr("id")&&c.settings.selected.push("#"+this.attr("id"))}):this.selected.attr("id")&&this.settings.selected.push("#"+this.selected.attr("id"));else if(this.settings.cookies&&a.cookie(this.settings.cookies.prefix+"_selected")){this.settings.selected=[];var d=a.cookie(this.settings.cookies.prefix+"_selected"),e=d.split(",");a.each(e,function(){this.replace(/^#/,"").length>0&&c.settings.selected.push("#"+this.replace(/^#/,""))})}else if(this.settings.selected!==!1){var e=[];(typeof this.settings.selected).toLowerCase()=="object"?a.each(this.settings.selected,function(){this.replace(/^#/,"").length>0&&e.push("#"+this.replace(/^#/,""))}):this.settings.selected.replace(/^#/,"").length>0&&e.push("#"+this.settings.selected.replace(/^#/,"")),this.settings.selected=e}if(b&&this.settings.data.async){this.opened=[],b=this.get_node(b),b.find("li.open").each(function(a){c.opened.push("#"+this.id)}),b.hasClass("open")&&b.removeClass("open").addClass("closed"),b.hasClass("leaf")&&b.removeClass("leaf"),b.children("ul:eq(0)").html("");return this.open_branch(b,!0,function(){c.reselect.apply(c)})}if(this.settings.data.type=="xml_flat"||this.settings.data.type=="xml_nested"){this.scrtop=this.container.get(0).scrollTop;var f=this.settings.data.type=="xml_flat"?"flat.xsl":"nested.xsl";this.settings.data.xml?this.container.getTransform(this.path+f,this.settings.data.xml,{params:{theme_name:c.settings.ui.theme_name,theme_path:c.theme},meth:c.settings.data.method,dat:c.settings.data.async_data.apply(c,[b,c]),callback:function(){c.context_menu.apply(c),c.reselect.apply(c)}}):this.container.getTransform(this.path+f,this.settings.data.url,{params:{theme_name:c.settings.ui.theme_name,theme_path:c.theme},meth:c.settings.data.method,dat:c.settings.data.async_data.apply(c,[b,c]),callback:function(){c.context_menu.apply(c),c.reselect.apply(c)}})}else if(this.settings.data.type=="json")if(this.settings.data.json){var d="";if(this.settings.data.json.length)for(var g=0;g<this.settings.data.json.length;g++)d+=this.parseJSON(this.settings.data.json[g]);else d=this.parseJSON(this.settings.data.json);this.container.html("<ul>"+d+"</ul>"),this.container.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed"),this.container.find("li").not(".open").not(".closed").addClass("leaf"),this.context_menu(),this.reselect()}else{var c=this;a.ajax({type:this.settings.data.method,url:this.settings.data.url,data:this.settings.data.async_data(!1,this),dataType:"json",success:function(a){a=c.settings.callback.onJSONdata.call(null,a,c);var b="";if(a.length)for(var d=0;d<a.length;d++)b+=c.parseJSON(a[d]);else b=c.parseJSON(a);c.container.html("<ul>"+b+"</ul>"),c.container.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed"),c.container.find("li").not(".open").not(".closed").addClass("leaf"),c.context_menu.apply(c),c.reselect.apply(c)},error:function(a,b,d){c.error(d+" "+b)}})}else this.container.children("ul:eq(0)"),this.container.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed"),this.container.find("li").not(".open").not(".closed").addClass("leaf"),this.reselect()},parseJSON:function(a){if(!a||!a.data)return"";var b="";b+="<li ";var c=!1;if(a.attributes)for(var d in a.attributes){if(typeof a.attributes[d]=="function")continue;if(d=="class"){b+=" class='"+a.attributes[d]+" ";if(a.state=="closed"||a.state=="open")b+=" "+a.state+" ";b+="' ",c=!0}else b+=" "+d+"='"+a.attributes[d]+"' "}!c&&(a.state=="closed"||a.state=="open")&&(b+=" class='"+a.state+"' "),b+=">";if(this.settings.languages.length)for(var d=0;d<this.settings.languages.length;d++){var e={};e.href="#",e.style="",e["class"]=this.settings.languages[d];if(a.data[this.settings.languages[d]]&&(typeof a.data[this.settings.languages[d]].attributes).toLowerCase()!="undefined")for(var f in a.data[this.settings.languages[d]].attributes){if(typeof a.data[this.settings.languages[d]].attributes[f]=="function")continue;f=="style"||f=="class"?e[f]+=" "+a.data[this.settings.languages[d]].attributes[f]:e[f]=a.data[this.settings.languages[d]].attributes[f]}if(a.data[this.settings.languages[d]]&&a.data[this.settings.languages[d]].icon&&this.settings.theme_name!="themeroller"){var g=a.data[this.settings.languages[d]].icon.indexOf("/")==-1?this.theme+a.data[this.settings.languages[d]].icon:a.data[this.settings.languages[d]].icon;e.style+=" ; background-image:url('"+g+"'); "}b+="<a";for(var f in e){if(typeof e[f]=="function")continue;b+=" "+f+'="'+e[f]+'" '}b+=">",a.data[this.settings.languages[d]]&&a.data[this.settings.languages[d]].icon&&this.settings.theme_name=="themeroller"&&(b+="<ins class='ui-icon "+a.data[this.settings.languages[d]].icon+"'>&nbsp;</ins>"),b+=((typeof a.data[this.settings.languages[d]].title).toLowerCase()!="undefined"?a.data[this.settings.languages[d]].title:a.data[this.settings.languages[d]])+"</a>"}else{var e={};e.href="#",e.style="",e["class"]="";if((typeof a.data.attributes).toLowerCase()!="undefined")for(var d in a.data.attributes){if(typeof a.data.attributes[d]=="function")continue;d=="style"||d=="class"?e[d]+=" "+a.data.attributes[d]:e[d]=a.data.attributes[d]}if(a.data.icon&&this.settings.ui.theme_name!="themeroller"){var g=a.data.icon.indexOf("/")==-1?this.theme+a.data.icon:a.data.icon;e.style+=" ; background-image:url('"+g+"');"}b+="<a";for(var d in e){if(typeof e[f]=="function")continue;b+=" "+d+'="'+e[d]+'" '}b+=">",a.data.icon&&this.settings.ui.theme_name=="themeroller"&&(b+="<ins class='ui-icon "+a.data.icon+"'>&nbsp;</ins>"),b+=((typeof a.data.title).toLowerCase()!="undefined"?a.data.title:a.data)+"</a>"}if(a.children&&a.children.length){b+="<ul>";for(var d=0;d<a.children.length;d++)b+=this.parseJSON(a.children[d]);b+="</ul>"}b+="</li>";return b},getJSON:function(b,c,d,e){var f=this;!b||a(b).size()==0?b=this.container.children("ul").children("li"):b=a(b);if(b.size()>1){var g=[];b.each(function(){g.push(f.getJSON(this,c,d,e))});return g}c||(c=["id","rel","class"]),d||(d=[]);var h={attributes:{},data:!1};for(var i in c){if(typeof c[i]=="function")continue;var j=c[i]=="class"?b.attr(c[i]).replace("last","").replace("leaf","").replace("closed","").replace("open",""):b.attr(c[i]);typeof j!="undefined"&&j.replace(" ","").length>0&&(h.attributes[c[i]]=j),delete j}if(this.settings.languages.length){h.data={};for(var i in this.settings.languages){if(typeof this.settings.languages[i]=="function")continue;var k=b.children("a."+this.settings.languages[i]);if(e||d.length||k.get(0).style.backgroundImage.toString().length){h.data[this.settings.languages[i]]={},h.data[this.settings.languages[i]].title=k.text(),k.get(0).style.backgroundImage.length&&(h.data[this.settings.languages[i]].icon=k.get(0).style.backgroundImage.replace("url(","").replace(")",""));if(this.settings.ui.theme_name=="themeroller"&&k.children("ins").size()){var l=k.children("ins").attr("class"),m=!1;a.each(l.split(" "),function(a,b){if(b.indexOf("ui-icon-")==0){m=b;return!1}}),m&&(h.data[this.settings.languages[i]].icon=m)}if(d.length){h.data[this.settings.languages[i]].attributes={};for(var n in d){if(typeof d[n]=="function")continue;var j=k.attr(d[n]);typeof j!="undefined"&&j.replace(" ","").length>0&&(h.data[this.settings.languages[i]].attributes[d[n]]=j),delete j}}}else h.data[this.settings.languages[i]]=k.text()}}else{var k=b.children("a");if(e||d.length||k.get(0).style.backgroundImage.toString().length){h.data={},h.data.title=k.text(),k.get(0).style.backgroundImage.length&&(h.data.icon=k.get(0).style.backgroundImage.replace("url(","").replace(")",""));if(this.settings.ui.theme_name=="themeroller"&&k.children("ins").size()){var l=k.children("ins").attr("class"),m=!1;a.each(l.split(" "),function(a,b){if(b.indexOf("ui-icon-")==0){m=b;return!1}}),m&&(h.data[this.settings.languages[i]].icon=m)}if(d.length){h.data.attributes={};for(var n in d){if(typeof d[n]=="function")continue;var j=k.attr(d[n]);typeof j!="undefined"&&j.replace(" ","").length>0&&(h.data.attributes[d[n]]=j),delete j}}}else h.data=k.text()}b.children("ul").size()>0&&(h.children=[],b.children("ul").children("li").each(function(){h.children.push(f.getJSON(this,c,d,e))}));return h},getXML:function(b,c,d,e,f){var g=this;b!="flat"&&(b="nested"),!c||a(c).size()==0?c=this.container.children("ul").children("li"):c=a(c);if(c.size()>1){var h="<root>";c.each(function(){h+=g.getXML(b,this,d,e,!0)}),h+="</root>";return h}d||(d=["id","rel","class"]),e||(e=[]);var h="";f||(h="<root>"),h+="<item ";if(b=="flat"){var i=c.parents("li:eq(0)").size()?c.parents("li:eq(0)").attr("id"):0;h+=' parent_id="'+i+'" ',delete i}for(var j in d){if(typeof d[j]=="function")continue;var k=d[j]=="class"?c.attr(d[j]).replace("last","").replace("leaf","").replace("closed","").replace("open",""):c.attr(d[j]);typeof k!="undefined"&&k.replace(" ","").length>0&&(h+=" "+d[j]+'="'+k+'" '),delete k}h+=">",h+="<content>";if(this.settings.languages.length)for(var j in this.settings.languages){if(typeof this.settings.languages[j]=="function")continue;var l=c.children("a."+this.settings.languages[j]);h+="<name ";if(e.length||l.get(0).style.backgroundImage.toString().length||this.settings.ui.theme_name=="themeroller"){l.get(0).style.backgroundImage.length&&(h+=' icon="'+l.get(0).style.backgroundImage.replace("url(","").replace(")","")+'" ');if(this.settings.ui.theme_name=="themeroller"&&l.children("ins").size()){var m=l.children("ins").attr("class"),n=!1;a.each(m.split(" "),function(a,b){if(b.indexOf("ui-icon-")==0){n=b;return!1}}),n&&(h+=' icon="'+n+'" ')}if(e.length)for(var o in e){if(typeof e[o]=="function")continue;var k=l.attr(e[o]);typeof k!="undefined"&&k.replace(" ","").length>0&&(h+=" "+e[o]+'="'+k+'" '),delete k}}h+="><![CDATA["+l.text()+"]]></name>"}else{var l=c.children("a");h+="<name ";if(e.length||l.get(0).style.backgroundImage.toString().length||this.settings.ui.theme_name=="themeroller"){l.get(0).style.backgroundImage.length&&(h+=' icon="'+l.get(0).style.backgroundImage.replace("url(","").replace(")","")+'" ');if(this.settings.ui.theme_name=="themeroller"&&l.children("ins").size()){var m=l.children("ins").attr("class"),n=!1;a.each(m.split(" "),function(a,b){if(b.indexOf("ui-icon-")==0){n=b;return!1}}),n&&(h+=' icon="'+n+'" ')}if(e.length)for(var o in e){if(typeof e[o]=="function")continue;var k=l.attr(e[o]);typeof k!="undefined"&&k.replace(" ","").length>0&&(h+=" "+e[o]+'="'+k+'" '),delete k}}h+="><![CDATA["+l.text()+"]]></name>"}h+="</content>",b=="flat"&&(h+="</item>"),c.children("ul").size()>0&&c.children("ul").children("li").each(function(){h+=g.getXML(b,this,d,e,!0)}),b=="nested"&&(h+="</item>"),f||(h+="</root>");return h},focus:function(){if(this.locked)return!1;b.focused!=this.cntr&&(b.focused=this.cntr,this.settings.callback.onfocus.call(null,this))},show_context:function(b){this.context.show();var c=a(b).children("a:visible").offset();this.context.css({left:c.left,top:c.top+parseInt(b.children("a:visible").height())+2})},hide_context:function(){this.context.to_remove&&this.context.apply_to&&this.context.apply_to.children("a").removeClass("clicked"),this.context.apply_to=!1,this.context.hide()},attachEvents:function(){var c=this;this.container.bind("mousedown.jstree",function(a){if(b.drag_drop.isdown){b.drag_drop.move_type=!1,a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation();return!1}}).bind("mouseup.jstree",function(a){setTimeout(function(){c.focus.apply(c)},5)}).bind("click.jstree",function(a){return!0}),a("#"+this.container.attr("id")+" li").live("click",function(b){if(b.target.tagName!="LI")return!0;c.off_height();if(b.pageY-a(b.target).offset().top>c.li_height)return!0;c.toggle_branch.apply(c,[b.target]),b.stopPropagation();return!1}),a("#"+this.container.attr("id")+" li a").live("click.jstree",function(a){if(a.which&&a.which==3)return!0;if(c.locked){a.preventDefault(),a.target.blur();return c.error("LOCKED")}c.select_branch.apply(c,[a.target,a.ctrlKey||c.settings.rules.multiple=="on"]),c.inp&&c.inp.blur(),a.preventDefault(),a.target.blur();return!1}).live("dblclick.jstree",function(a){if(c.locked){a.preventDefault(),a.stopPropagation(),a.target.blur();return c.error("LOCKED")}c.settings.callback.ondblclk.call(null,c.get_node(a.target).get(0),c),a.preventDefault(),a.stopPropagation(),a.target.blur()}).live("contextmenu.jstree",function(b){if(c.locked){b.target.blur();return c.error("LOCKED")}var d=c.settings.callback.onrgtclk.call(null,c.get_node(b.target).get(0),c,b);if(c.context){if(c.context.append==!1){a("body").append(c.context),c.context.append=!0;for(var e in c.settings.ui.context){if(typeof c.settings.ui.context[e]=="function")continue;if(c.settings.ui.context[e]=="separator")continue;(function(){var b=c.settings.ui.context[e].action;c.context.children("[rel="+c.settings.ui.context[e].id+"]").bind("click",function(d){a(this).hasClass("disabled")||(b.call(null,c.context.apply_to||null,c),c.hide_context()),d.stopPropagation(),d.preventDefault();return!1}).bind("mouseup",function(b){this.blur();if(a(this).hasClass("disabled")){b.stopPropagation(),b.preventDefault();return!1}}).bind("mousedown",function(a){a.stopPropagation(),a.preventDefault()})})()}}var f=c.get_node(b.target);c.inp&&c.inp.blur();if(f){f.children("a:eq(0)").hasClass("clicked")?(c.context.to_remove=!1,c.context.apply_to=c.selected_arr&&c.selected_arr.length>1?c.selected_arr:c.selected):(c.context.apply_to=f,c.context.to_remove=!0,c.context.apply_to.children("a").addClass("clicked"),b.target.blur()),c.context.children("a").removeClass("disabled").show();var g=!1;for(var e in c.settings.ui.context){if(typeof c.settings.ui.context[e]=="function")continue;if(c.settings.ui.context[e]=="separator")continue;var h=c.settings.ui.context[e].visible.call(null,c.context.apply_to,c);h===!1&&c.context.children("[rel="+c.settings.ui.context[e].id+"]").addClass("disabled"),h===-1?c.context.children("[rel="+c.settings.ui.context[e].id+"]").hide():g=!0}g==!0&&c.show_context(f),b.preventDefault(),b.stopPropagation();return!1}}return d}).live("mouseover.jstree",function(a){if(c.locked){a.preventDefault(),a.stopPropagation();return c.error("LOCKED")}(c.settings.ui.hover_mode||c.settings.ui.theme_name=="themeroller")&&c.hovered!==!1&&a.target.tagName=="A"&&(c.hovered.children("a").removeClass("hover ui-state-hover"),c.hovered=!1),c.settings.ui.theme_name=="themeroller"&&c.hover_branch.apply(c,[a.target])}),c.settings.ui.theme_name=="themeroller"&&a("#"+this.container.attr("id")+" li a").live("mouseout",function(a){c.hovered&&c.hovered.children("a").removeClass("hover ui-state-hover")}),this.settings.rules.draggable!="none"&&(a("#"+this.container.attr("id")+" li a").live("mousedown.jstree",function(d){if(c.settings.rules.drag_button=="left"&&d.which&&d.which!=1)return!0;if(c.settings.rules.drag_button=="right"&&d.which&&d.which!=3)return!0;c.focus.apply(c);if(c.locked)return c.error("LOCKED");var e=c.get_node(d.target);if(c.settings.rules.multiple!=!1&&c.selected_arr.length>1&&e.children("a:eq(0)").hasClass("clicked")){var f=0;for(var g in c.selected_arr){if(typeof c.selected_arr[g]=="function")continue;c.check("draggable",c.selected_arr[g])&&(c.selected_arr[g].addClass("dragged"),b.drag_drop.origin_tree=c,f++)}if(f>0){c.check("draggable",e)?b.drag_drop.drag_node=e:b.drag_drop.drag_node=c.container.find("li.dragged:eq(0)"),b.drag_drop.isdown=!0,b.drag_drop.drag_help=a("<div id='jstree-dragged' class='tree "+(c.container.hasClass("tree-default")?" tree-default":"")+(c.settings.ui.theme_name&&c.settings.ui.theme_name!="default"?" tree-"+c.settings.ui.theme_name:"")+"' />").append("<ul class='"+c.container.children("ul:eq(0)").get(0).className+"' />");var h=a(b.drag_drop.drag_node.get(0).cloneNode(!0));c.settings.languages.length>0&&h.find("a").not("."+c.current_lang).hide(),b.drag_drop.drag_help.children("ul:eq(0)").append(h),b.drag_drop.drag_help.find("li:eq(0)").removeClass("last").addClass("last").children("a").html("Multiple selection").end().children("ul").remove()}}else if(c.check("draggable",e)){b.drag_drop.drag_node=e,b.drag_drop.drag_help=a("<div id='jstree-dragged' class='tree "+(c.container.hasClass("tree-default")?" tree-default":"")+(c.settings.ui.theme_name&&c.settings.ui.theme_name!="default"?" tree-"+c.settings.ui.theme_name:"")+"' />").append("<ul class='"+c.container.children("ul:eq(0)").get(0).className+"' />");var h=a(e.get(0).cloneNode(!0));c.settings.languages.length>0&&h.find("a").not("."+c.current_lang).hide(),b.drag_drop.drag_help.children("ul:eq(0)").append(h),b.drag_drop.drag_help.find("li:eq(0)").removeClass("last").addClass("last"),b.drag_drop.isdown=!0,b.drag_drop.foreign=!1,b.drag_drop.origin_tree=c,e.addClass("dragged")}b.drag_drop.init_x=d.pageX,b.drag_drop.init_y=d.pageY,e.blur(),d.preventDefault(),d.stopPropagation();return!1}),a(document).bind("mousedown.jstree",b.mousedown).bind("mouseup.jstree",b.mouseup).bind("mousemove.jstree",b.mousemove)),c.context&&a(document).bind("mousedown",function(){c.hide_context()})},checkMove:function(c,d,e){if(this.locked)return this.error("LOCKED");var f=this;if(d.parents("li.dragged").size()>0||d.is(".dragged"))return this.error("MOVE: NODE OVER SELF");if(c.size()==1){var g=c.eq(0);if(b.drag_drop.foreign){if(this.settings.rules.droppable.length==0)return!1;if(!g.is("."+this.settings.rules.droppable.join(", .")))return!1;var h=!1;for(var i in this.settings.rules.droppable){if(typeof this.settings.rules.droppable[i]=="function")continue;if(g.is("."+this.settings.rules.droppable[i])){this.settings.rules.metadata?(a.metadata.setType("attr",this.settings.rules.metadata),g.attr(this.settings.rules.metadata,"type: '"+this.settings.rules.droppable[i]+"'")):g.attr(this.settings.rules.type_attr,this.settings.rules.droppable[i]),h=!0;break}}if(!h)return!1}if(!this.check("dragrules",[g,e,d.parents("li:eq(0)")]))return this.error("MOVE: AGAINST DRAG RULES")}else{var h=!0;c.each(function(b){if(h==!1)return!1;var c=d,g=e;f.check.apply(f,["dragrules",[a(this),g,c]])||(h=!1)});if(h==!1)return this.error("MOVE: AGAINST DRAG RULES")}if(this.settings.rules.use_inline&&this.settings.rules.metadata){var j=!1;e=="inside"?j=d.parents("li:eq(0)"):j=d.parents("li:eq(1)");if(j.size()){if(typeof j.metadata().valid_children!="undefined"){var k=j.metadata().valid_children,h=!0;c.each(function(b){if(h==!1)return!1;a.inArray(f.get_type(this),k)==-1&&(h=!1)});if(h==!1)return this.error("MOVE: NOT A VALID CHILD")}if(typeof j.metadata().max_children!="undefined"&&j.children("ul:eq(0)").children("li").not(".dragged").size()+c.size()>j.metadata().max_children)return this.error("MOVE: MAX CHILDREN REACHED"
);var l=0;c.each(function(b){var c=1,d=a(this);while(c<100){d=d.children("ul").children("li");if(d.size()==0)break;c++}l=Math.max(c,l)});var h=!0;(typeof a(j).metadata().max_depth).toLowerCase()!="undefined"&&a(j).metadata().max_depth<l?h=!1:j.parents("li").each(function(b){if(h==!1)return!1;(typeof a(this).metadata().max_depth).toLowerCase()!="undefined"&&b+l>=a(this).metadata().max_depth&&(h=!1)});if(h==!1)return this.error("MOVE: MAX_DEPTH REACHED")}}return!0},reselect:function(b){var c=this;b?this.cl_count--:this.cl_count=0;if(this.opened&&this.opened.length){var d=!1;for(var e=0;this.opened&&e<this.opened.length;e++)if(this.settings.data.async){if(this.get_node(this.opened[e]).size()>0){d=!0;var f=this.opened[e];delete this.opened[e],this.open_branch(f,!0,function(){c.reselect.apply(c,[!0])}),this.cl_count++}}else this.open_branch(this.opened[e],!0);if(this.settings.data.async&&d)return;delete this.opened}this.cl_count>0||(this.settings.ui.rtl?this.container.css("direction","rtl").children("ul:eq(0)").addClass("rtl"):this.container.css("direction","ltr").children("ul:eq(0)").addClass("ltr"),this.settings.ui.dots==!1&&this.container.children("ul:eq(0)").addClass("no_dots"),this.scrtop&&(this.container.scrollTop(c.scrtop),delete this.scrtop),this.settings.selected!==!1&&(a.each(this.settings.selected,function(b){c.is_partial_refresh?c.select_branch(a(c.settings.selected[b],c.container),c.settings.rules.multiple!==!1):c.select_branch(a(c.settings.selected[b],c.container),c.settings.rules.multiple!==!1&&b>0)}),this.settings.selected=!1),this.settings.ui.theme_name=="themeroller"&&this.container.find("a").addClass("ui-state-default"),this.settings.callback.onload.call(null,c))},get_node:function(b){var b=a(b);return b.is("li")?b:b.parents("li:eq(0)")},get_type:function(b){b=b?this.get_node(b):this.selected;if(!!b){if(this.settings.rules.metadata){a.metadata.setType("attr",this.settings.rules.metadata);var c=b.metadata().type;if(c)return c}return b.attr(this.settings.rules.type_attr)}},scrollCheck:function(a,c){var d=this,e=d.container,f=d.container.offset(),g=e.scrollTop(),h=e.scrollLeft(),i=e.get(0).scrollWidth>e.width()?40:20;c-f.top<20&&e.scrollTop(Math.max(g-d.settings.ui.scroll_spd,0)),e.height()-(c-f.top)<i&&e.scrollTop(g+d.settings.ui.scroll_spd),a-f.left<20&&e.scrollLeft(Math.max(h-d.settings.ui.scroll_spd,0)),e.width()-(a-f.left)<40&&e.scrollLeft(h+d.settings.ui.scroll_spd);if(e.scrollLeft()!=h||e.scrollTop()!=g)d.moveType=!1,d.moveRef=!1,b.drag_drop.marker.hide();b.drag_drop.scroll_time=setTimeout(function(){d.scrollCheck(a,c)},50)},check:function(b,c){if(this.locked)return this.error("LOCKED");if(b!="dragrules"&&this.settings.rules.use_inline&&this.settings.rules.metadata){a.metadata.setType("attr",this.settings.rules.metadata);if(typeof this.get_node(c).metadata()[b]!="undefined")return this.get_node(c).metadata()[b]}if(!this.settings.rules[b])return!1;if(this.settings.rules[b]=="none")return!1;if(this.settings.rules[b]=="all")return!0;if(b=="dragrules"){var d=[];d[0]=this.get_type(c[0]),d[1]=c[1],d[2]=this.get_type(c[2]);for(var e=0;e<this.settings.rules.dragrules.length;e++){var f=this.settings.rules.dragrules[e],g=f.indexOf("!")===0?!1:!0;g||(f=f.replace("!",""));var h=f.split(" ");for(var i=0;i<3;i++)if(h[i]==d[i]||h[i]=="*")h[i]=!0;if(h[0]===!0&&h[1]===!0&&h[2]===!0)return g}return!1}return a.inArray(this.get_type(c),this.settings.rules[b])!=-1?!0:!1},hover_branch:function(a){if(this.locked)return this.error("LOCKED");if(this.settings.ui.hover_mode==!1&&this.settings.ui.theme_name!="themeroller")return this.select_branch(a);var b=this,a=b.get_node(a);if(!a.size())return this.error("HOVER: NOT A VALID NODE");if(!b.check("clickable",a))return this.error("SELECT: NODE NOT SELECTABLE");this.hovered&&this.hovered.children("A").removeClass("hover ui-state-hover"),this.hovered=a,this.hovered.children("a").removeClass("hover ui-state-hover").addClass(this.settings.ui.theme_name=="themeroller"?"hover ui-state-hover":"hover");var c=this.hovered.offset().top,d=this.container.offset().top,e=d+this.container.height(),f=this.container.get(0).scrollWidth>this.container.width()?40:20;c+5<d&&this.container.scrollTop(this.container.scrollTop()-(d-c+5)),c+f>e&&this.container.scrollTop(this.container.scrollTop()+(c+f-e))},select_branch:function(a,b){if(this.locked)return this.error("LOCKED");!a&&this.hovered!==!1&&(a=this.hovered);var c=this;a=c.get_node(a);if(!a.size())return this.error("SELECT: NOT A VALID NODE");a.children("a").removeClass("hover ui-state-hover");if(!c.check("clickable",a))return this.error("SELECT: NODE NOT SELECTABLE");if(c.settings.callback.beforechange.call(null,a.get(0),c)===!1)return this.error("SELECT: STOPPED BY USER");if(this.settings.rules.multiple!=!1&&b&&a.children("a.clicked").size()>0)return this.deselect_branch(a);this.settings.rules.multiple!=!1&&b&&this.selected_arr.push(a);if(this.settings.rules.multiple!=!1&&!b){for(var d in this.selected_arr){if(typeof this.selected_arr[d]=="function")continue;this.selected_arr[d].children("A").removeClass("clicked ui-state-active"),this.settings.callback.ondeselect.call(null,this.selected_arr[d].get(0),c)}this.selected_arr=[],this.selected_arr.push(a),this.selected&&this.selected.children("A").hasClass("clicked")&&(this.selected.children("A").removeClass("clicked ui-state-active"),this.settings.callback.ondeselect.call(null,this.selected.get(0),c))}this.settings.rules.multiple||this.selected&&(this.selected.children("A").removeClass("clicked ui-state-active"),this.settings.callback.ondeselect.call(null,this.selected.get(0),c)),this.selected=a,(this.settings.ui.hover_mode||this.settings.ui.theme_name=="themeroller")&&this.hovered!==!1&&(this.hovered.children("A").removeClass("hover ui-state-hover"),this.hovered=a),this.selected.children("a").removeClass("clicked ui-state-active").addClass(this.settings.ui.theme_name=="themeroller"?"clicked ui-state-active":"clicked").end().parents("li.closed").each(function(){c.open_branch(this,!0)});var e=this.selected.offset().top,f=this.container.offset().top,g=f+this.container.height(),h=this.container.get(0).scrollWidth>this.container.width()?40:20;e+5<f&&this.container.scrollTop(this.container.scrollTop()-(f-e+5)),e+h>g&&this.container.scrollTop(this.container.scrollTop()+(e+h-g)),this.set_cookie("selected"),this.settings.callback.onselect.call(null,this.selected.get(0),c),this.settings.callback.onchange.call(null,this.selected.get(0),c)},deselect_branch:function(b){if(this.locked)return this.error("LOCKED");var c=this,b=this.get_node(b);b.children("a").removeClass("clicked ui-state-active"),this.settings.callback.ondeselect.call(null,b.get(0),c),this.settings.rules.multiple!=!1&&this.selected_arr.length>1?(this.selected_arr=[],this.container.find("a.clicked").filter(":first-child").parent().each(function(){c.selected_arr.push(a(this))}),b.get(0)==this.selected.get(0)&&(this.selected=this.selected_arr[0],this.set_cookie("selected"))):(this.settings.rules.multiple!=!1&&(this.selected_arr=[]),this.selected=!1,this.set_cookie("selected")),this.selected?this.settings.callback.onchange.call(null,this.selected.get(0),c):this.settings.callback.onchange.call(null,!1,c)},toggle_branch:function(a){if(this.locked)return this.error("LOCKED");var a=this.get_node(a);if(a.hasClass("closed"))return this.open_branch(a);if(a.hasClass("open"))return this.close_branch(a)},open_branch:function(b,c,d){if(this.locked)return this.error("LOCKED");var b=this.get_node(b);if(!b.size())return this.error("OPEN: NO SUCH NODE");if(b.hasClass("leaf"))return this.error("OPEN: OPENING LEAF NODE");if(this.settings.data.async&&b.find("li").size()==0){if(this.settings.callback.beforeopen.call(null,b.get(0),this)===!1)return this.error("OPEN: STOPPED BY USER");var e=this;b.children("ul:eq(0)").remove().end().append("<ul><li class='last'><a class='loading' href='#'>"+(e.settings.lang.loading||"Loading ...")+"</a></li></ul>"),b.removeClass("closed").addClass("open");if(this.settings.data.type=="xml_flat"||this.settings.data.type=="xml_nested"){var f=this.settings.data.type=="xml_flat"?"flat.xsl":"nested.xsl";b.children("ul:eq(0)").getTransform(this.path+f,this.settings.data.url,{params:{theme_path:e.theme},meth:this.settings.data.method,dat:this.settings.data.async_data(b,this),repl:!0,callback:function(a,c){a.length<15?(b.removeClass("closed").removeClass("open").addClass("leaf").children("ul").remove(),d&&d.call()):(e.open_branch.apply(e,[b]),d&&d.call())},error:function(){b.removeClass("open").addClass("closed").children("ul:eq(0)").remove()}})}else a.ajax({type:this.settings.data.method,url:this.settings.data.url,data:this.settings.data.async_data(b,this),dataType:"json",success:function(a,c){a=e.settings.callback.onJSONdata.call(null,a,e);if(!a||a.length==0)b.removeClass("closed").removeClass("open").addClass("leaf").children("ul").remove(),d&&d.call();else{var f="";if(a.length)for(var g=0;g<a.length;g++)f+=e.parseJSON(a[g]);else f=e.parseJSON(a);f.length>0?(b.children("ul:eq(0)").replaceWith("<ul>"+f+"</ul>"),b.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed"),b.find("li").not(".open").not(".closed").addClass("leaf"),e.open_branch.apply(e,[b])):b.removeClass("closed").removeClass("open").addClass("leaf").children("ul").remove(),d&&d.call()}},error:function(a,c,d){b.removeClass("open").addClass("closed").children("ul:eq(0)").remove(),e.error(d+" "+c)}});return!0}if(!this.settings.data.async&&this.settings.callback.beforeopen.call(null,b.get(0),this)===!1)return this.error("OPEN: STOPPED BY USER");this.settings.ui.theme_name=="themeroller"&&b.find("a").not(".ui-state-default").addClass("ui-state-default"),parseInt(this.settings.ui.animation)>0&&!c?(b.children("ul:eq(0)").css("display","none"),b.removeClass("closed").addClass("open"),b.children("ul:eq(0)").slideDown(parseInt(this.settings.ui.animation),function(){a(this).css("display",""),d&&d.call()})):(b.removeClass("closed").addClass("open"),d&&d.call()),this.set_cookie("open"),this.settings.callback.onopen.call(null,b.get(0),this);return!0},close_branch:function(b,c){if(this.locked)return this.error("LOCKED");var d=this,b=this.get_node(b);if(!b.size())return this.error("CLOSE: NO SUCH NODE");if(d.settings.callback.beforeclose.call(null,b.get(0),d)===!1)return this.error("CLOSE: STOPPED BY USER");parseInt(this.settings.ui.animation)>0&&!c&&b.children("ul:eq(0)").size()==1?b.children("ul:eq(0)").slideUp(parseInt(this.settings.ui.animation),function(){b.hasClass("open")&&b.removeClass("open").addClass("closed"),d.set_cookie("open"),a(this).css("display","")}):(b.hasClass("open")&&b.removeClass("open").addClass("closed"),this.set_cookie("open")),this.selected&&b.children("ul:eq(0)").find("a.clicked").size()>0&&(b.find("li:has(a.clicked)").each(function(){d.deselect_branch(this)}),b.children("a.clicked").size()==0&&this.select_branch(b,this.settings.rules.multiple!=!1&&this.selected_arr.length>0)),this.settings.callback.onclose.call(null,b.get(0),this)},open_all:function(a,b){if(this.locked)return this.error("LOCKED");var c=this;a=a?this.get_node(a).parent():this.container;var d=a.find("li.closed").size();b?this.cl_count--:this.cl_count=0,d>0?(this.cl_count+=d,a.find("li.closed").each(function(){var a=this;c.open_branch.apply(c,[this,!0,function(){c.open_all.apply(c,[a,!0])}])})):this.cl_count==0&&this.settings.callback.onopen_all.call(null,this)},close_all:function(){if(this.locked)return this.error("LOCKED");var a=this;this.container.find("li.open").each(function(){a.close_branch(this,!0)})},show_lang:function(a){if(this.locked)return this.error("LOCKED");if(this.settings.languages[a]==this.current_lang)return!0;var b=!1,c=this.container.attr("id")?"#"+this.container.attr("id"):".tree";b=get_css(c+" ."+this.current_lang,this.sn),b!==!1&&(b.style.display="none"),b=get_css(c+" ."+this.settings.languages[a],this.sn),b!==!1&&(b.style.display=""),this.current_lang=this.settings.languages[a];return!0},cycle_lang:function(){if(this.locked)return this.error("LOCKED");var b=a.inArray(this.current_lang,this.settings.languages);b++,b>this.settings.languages.length-1&&(b=0),this.show_lang(b)},create:function(b,c,d){if(this.locked)return this.error("LOCKED");var e=!1;c==-1?(e=!0,c=this.container):c=c?this.get_node(c):this.selected;if(!e&&(!c||!c.size()))return this.error("CREATE: NO NODE SELECTED");var f=d,g=c;d=="before"&&(d=c.parent().children().index(c),c=c.parents("li:eq(0)")),d=="after"&&(d=c.parent().children().index(c)+1,c=c.parents("li:eq(0)")),!e&&c.size()==0&&(e=!0,c=this.container);if(!e){if(!this.check("creatable",c))return this.error("CREATE: CANNOT CREATE IN NODE");if(c.hasClass("closed")){if(this.settings.data.async&&c.children("ul").size()==0){var h=this;return this.open_branch(c,!0,function(){h.create.apply(h,[b,c,d])})}this.open_branch(c,!0)}}var i=!1;b?b=a.extend(!0,{},b):b={},b.attributes||(b.attributes={}),this.settings.rules.metadata?b.attributes[this.settings.rules.metadata]||(b.attributes[this.settings.rules.metadata]='{ "type" : "'+(this.get_type(g)||"")+'" }'):b.attributes[this.settings.rules.type_attr]||(b.attributes[this.settings.rules.type_attr]=this.get_type(g)||"");if(this.settings.languages.length){b.data||(b.data={},i=!0);for(var j=0;j<this.settings.languages.length;j++)b.data[this.settings.languages[j]]||(b.data[this.settings.languages[j]]=(typeof this.settings.lang.new_node).toLowerCase()!="string"&&this.settings.lang.new_node[j]?this.settings.lang.new_node[j]:this.settings.lang.new_node)}else b.data||(b.data=this.settings.lang.new_node,i=!0);var k=a(this.parseJSON(b));k.children("ul").size()?k.is(".open")||k.addClass("closed"):k.addClass("leaf"),k.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed"),k.find("li").not(".open").not(".closed").addClass("leaf");if(!e&&this.settings.rules.use_inline&&this.settings.rules.metadata){var l=this.get_type(k)||"";a.metadata.setType("attr",this.settings.rules.metadata);if(typeof c.metadata().valid_children!="undefined"&&a.inArray(l,c.metadata().valid_children)==-1)return this.error("CREATE: NODE NOT A VALID CHILD");if(typeof c.metadata().max_children!="undefined"&&c.children("ul:eq(0)").children("li").size()+1>c.metadata().max_children)return this.error("CREATE: MAX_CHILDREN REACHED");var m=!0;(typeof a(c).metadata().max_depth).toLowerCase()!="undefined"&&a(c).metadata().max_depth===0?m=!1:c.parents("li").each(function(b){if(a(this).metadata().max_depth&&b+1>=a(this).metadata().max_depth){m=!1;return!1}});if(!m)return this.error("CREATE: MAX_DEPTH REACHED")}if((typeof d).toLowerCase()=="undefined"||d=="inside")d=this.settings.rules.createat=="top"?0:c.children("ul:eq(0)").children("li").size();if(c.children("ul").size()==0||e==!0&&c.children("ul").children("li").size()==0)if(!e)var n=this.moved(k,c.children("a:eq(0)"),"inside",!0);else var n=this.moved(k,this.container.children("ul:eq(0)"),"inside",!0);else if(f=="before"&&c.children("ul:eq(0)").children("li:nth-child("+(d+1)+")").size())var n=this.moved(k,c.children("ul:eq(0)").children("li:nth-child("+(d+1)+")").children("a:eq(0)"),"before",!0);else if(f=="after"&&c.children("ul:eq(0)").children("li:nth-child("+d+")").size())var n=this.moved(k,c.children("ul:eq(0)").children("li:nth-child("+d+")").children("a:eq(0)"),"after",!0);else if(c.children("ul:eq(0)").children("li:nth-child("+(d+1)+")").size())var n=this.moved(k,c.children("ul:eq(0)").children("li:nth-child("+(d+1)+")").children("a:eq(0)"),"before",!0);else var n=this.moved(k,c.children("ul:eq(0)").children("li:last").children("a:eq(0)"),"after",!0);if(n===!1)return this.error("CREATE: ABORTED");i&&(this.select_branch(k.children("a:eq(0)")),this.rename());return k},rename:function(b){if(this.locked)return this.error("LOCKED");b=b?this.get_node(b):this.selected;var c=this;if(!b||!b.size())return this.error("RENAME: NO NODE SELECTED");if(!this.check("renameable",b))return this.error("RENAME: NODE NOT RENAMABLE");if(!this.settings.callback.beforerename.call(null,b.get(0),c.current_lang,c))return this.error("RENAME: STOPPED BY USER");b.parents("li.closed").each(function(){c.open_branch(this)}),this.current_lang?b=b.find("a."+this.current_lang).get(0):b=b.find("a:first").get(0),last_value=b.innerHTML,c.inp=a("<input type='text' autocomplete='off' />"),c.inp.val(last_value.replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<")).bind("mousedown",function(a){a.stopPropagation()}).bind("mouseup",function(a){a.stopPropagation()}).bind("click",function(a){a.stopPropagation()}).bind("keyup",function(a){var b=a.keyCode||a.which;if(b==27)this.value=last_value,this.blur();else if(b==13){this.blur();return}});var d={};d[this.container.attr("id")]=this.get_rollback(),c.inp.blur(function(e){this.value==""&&(this.value=last_value),a(b).text(a(b).parent().find("input").eq(0).attr("value")).get(0).style.display="",a(b).prevAll("span").remove(),c.settings.callback.onrename.call(null,c.get_node(b).get(0),c.current_lang,c,d),c.inp=!1});var e=a("<span />").addClass(b.className).append(c.inp);e.attr("style",a(b).attr("style")),b.style.display="none",a(b).parent().prepend(e),c.inp.get(0).focus(),c.inp.get(0).select()},remove:function(b){if(this.locked)return this.error("LOCKED");var c={};c[this.container.attr("id")]=this.get_rollback();if(b&&(!this.selected||this.get_node(b).get(0)!=this.selected.get(0))){b=this.get_node(b);if(b.size()){if(!this.check("deletable",b))return this.error("DELETE: NODE NOT DELETABLE");if(!this.settings.callback.beforedelete.call(null,b.get(0),f))return this.error("DELETE: STOPPED BY USER");$parent=b.parent(),b=b.remove(),$parent.children("li:last").addClass("last"),$parent.children("li").size()==0&&($li=$parent.parents("li:eq(0)"),$li.removeClass("open").removeClass("closed").addClass("leaf").children("ul").remove(),this.set_cookie("open")),this.settings.callback.ondelete.call(null,b.get(0),this,c)}}else{if(!this.selected)return this.error("DELETE: NO NODE SELECTED");if(!this.check("deletable",this.selected))return this.error("DELETE: NODE NOT DELETABLE");if(!this.settings.callback.beforedelete.call(null,this.selected.get(0),f))return this.error("DELETE: STOPPED BY USER");$parent=this.selected.parent();var b=this.selected;if(this.settings.rules.multiple==!1||this.selected_arr.length==1)var d=!0,e=this.selected.prev("li:eq(0)").size()?this.selected.prev("li:eq(0)"):this.selected.parents("li:eq(0)");b=b.remove(),$parent.children("li:last").addClass("last"),$parent.children("li").size()==0&&($li=$parent.parents("li:eq(0)"),$li.removeClass("open").removeClass("closed").addClass("leaf").children("ul").remove(),this.set_cookie("open")),this.settings.callback.ondelete.call(null,b.get(0),this,c),d&&e&&this.select_branch(e);if(this.settings.rules.multiple!=!1&&!d){var f=this;this.selected_arr=[],this.container.find("a.clicked").filter(":first-child").parent().each(function(){f.selected_arr.push(a(this))}),this.selected_arr.length>0&&(this.selected=this.selected_arr[0],this.remove())}}},next:function(a,b){a=this.get_node(a);if(!a.size())return!1;if(b)return a.nextAll("li").size()>0?a.nextAll("li:eq(0)"):!1;return a.hasClass("open")?a.find("li:eq(0)"):a.nextAll("li").size()>0?a.nextAll("li:eq(0)"):a.parents("li").next("li").eq(0)},prev:function(a,b){a=this.get_node(a);if(!a.size())return!1;if(b)return a.prevAll("li").size()>0?a.prevAll("li:eq(0)"):!1;if(a.prev("li").size()){var a=a.prev("li").eq(0);while(a.hasClass("open"))a=a.children("ul:eq(0)").children("li:last");return a}return a.parents("li:eq(0)").size()?a.parents("li:eq(0)"):!1},parent:function(a){a=this.get_node(a);if(!a.size())return!1;return a.parents("li:eq(0)").size()?a.parents("li:eq(0)"):!1},children:function(a){a=this.get_node(a);if(!a.size())return!1;return a.children("ul:eq(0)").children("li")},get_next:function(a){var b=this.hovered||this.selected;return a?this.select_branch(this.next(b)):this.hover_branch(this.next(b))},get_prev:function(a){var b=this.hovered||this.selected;return a?this.select_branch(this.prev(b)):this.hover_branch(this.prev(b))},get_left:function(a,b){if(this.settings.ui.rtl&&!b)return this.get_right(a,!0);var c=this.hovered||this.selected;if(c)if(c.hasClass("open"))this.close_branch(c);else return a?this.select_branch(this.parent(c)):this.hover_branch(this.parent(c))},get_right:function(a,b){if(this.settings.ui.rtl&&!b)return this.get_left(a,!0);var c=this.hovered||this.selected;if(c)if(c.hasClass("closed"))this.open_branch(c);else return a?this.select_branch(c.find("li:eq(0)")):this.hover_branch(c.find("li:eq(0)"))},toggleDots:function(){this.settings.ui.dots?(this.settings.ui.dots=!1,this.container.children("ul:eq(0)").addClass("no_dots")):(this.settings.ui.dots=!0,this.container.children("ul:eq(0)").removeClass("no_dots"))},toggleRTL:function(){this.settings.ui.rtl?(this.settings.ui.rtl=!1,this.container.css("direction","ltr").children("ul:eq(0)").removeClass("rtl").addClass("ltr")):(this.settings.ui.rtl=!0,this.container.css("direction","rtl").children("ul:eq(0)").removeClass("ltr").addClass("rtl"))},set_cookie:function(b){if(this.settings.cookies===!1)return!1;if(this.settings.cookies[b]===!1)return!1;switch(b){case"selected":if(this.settings.rules.multiple!=!1&&this.selected_arr.length>1){var c=[];a.each(this.selected_arr,function(){this.attr("id")&&c.push(this.attr("id"))}),c=c.join(",")}else var c=this.selected?this.selected.attr("id"):!1;a.cookie(this.settings.cookies.prefix+"_selected",c,this.settings.cookies.opts);break;case"open":var d="";this.container.find("li.open").each(function(a){this.id&&(d+=this.id+",")}),a.cookie(this.settings.cookies.prefix+"_open",d.replace(/,$/ig,""),this.settings.cookies.opts)}},get_rollback:function(){var a={};this.context.to_remove&&this.context.apply_to&&this.context.apply_to.children("a").removeClass("clicked"),a.html=this.container.html(),this.context.to_remove&&this.context.apply_to&&this.context.apply_to.children("a").addClass("clicked"),a.selected=this.selected?this.selected.attr("id"):!1;return a},moved:function(c,d,e,f,g,h){var c=a(c),i=a(c).parents("ul:eq(0)"),j=a(d);if(!h){var h={};h[this.container.attr("id")]=this.get_rollback();if(!f){var k=c.size()>1?c.eq(0).parents(".tree:eq(0)"):c.parents(".tree:eq(0)");k.get(0)!=this.container.get(0)&&(k=b.inst[k.attr("id")],h[k.container.attr("id")]=k.get_rollback()),delete k}}if(e=="inside"&&this.settings.data.async&&this.get_node(j).hasClass("closed")){var l=this;return this.open_branch(this.get_node(j),!0,function(){l.moved.apply(l,[c,d,e,f,g,h])})}{if(!(c.size()>1)){g?(_what=c.clone(),_what.each(function(b){this.id=this.id+"_copy",a(this).find("li").each(function(){this.id=this.id+"_copy"}),a(this).removeClass("dragged").find("a.clicked").removeClass("clicked ui-state-active").end().find("li.dragged").removeClass("dragged")})):_what=c;if(f){if(!this.settings.callback.beforecreate.call(null,this.get_node(c).get(0),this.get_node(d).get(0),e,this))return!1}else if(!this.settings.callback.beforemove.call(null,this.get_node(c).get(0),this.get_node(d).get(0),e,this))return!1;if(!f){var k=c.parents(".tree:eq(0)");if(k.get(0)!=this.container.get(0)){k=b.inst[k.attr("id")];if(k.settings.languages.length){var m=[];if(this.settings.languages.length==0)m.push("."+k.current_lang);else for(var n in this.settings.languages){if(typeof this.settings.languages[n]=="function")continue;for(var o in k.settings.languages){if(typeof k.settings.languages[o]=="function")continue;this.settings.languages[n]==k.settings.languages[o]&&m.push("."+this.settings.languages[n])}}if(m.length==0)return this.error("MOVE: NO COMMON LANGUAGES");c.find("a").not(m.join(",")).remove()}c.find("a.clicked").removeClass("clicked ui-state-active")}}c=_what;switch(e){case"before":j.parents("ul:eq(0)").children("li.last").removeClass("last"),j.parent().before(c.removeClass("last")),j.parents("ul:eq(0)").children("li:last").addClass("last");break;case"after":j.parents("ul:eq(0)").children("li.last").removeClass("last"),j.parent().after(c.removeClass("last")),j.parents("ul:eq(0)").children("li:last").addClass("last");break;case"inside":j.parent().children("ul:first").size()?this.settings.rules.createat=="top"?j.parent().children("ul:first").prepend(c.removeClass("last")).children("li:last").addClass("last"):j.parent().children("ul:first").children(".last").removeClass("last").end().append(c.removeClass("last")).children("li:last").addClass("last"):(c.addClass("last"),j.parent().append("<ul/>").removeClass("leaf").addClass("closed"),j.parent().children("ul:first").prepend(c)),j.parent().hasClass("closed")&&this.open_branch(j);break;default:}if(i.find("li").size()==0){var p=i.parent();p.removeClass("open").removeClass("closed").addClass("leaf"),p.is(".tree")||p.children("ul").remove(),p.parents("ul:eq(0)").children("li.last").removeClass("last").end().children("li:last").addClass("last"),this.set_cookie("open")}else i.children("li.last").removeClass("last"),i.children("li:last").addClass("last");g?this.settings.callback.oncopy.call(null,this.get_node(c).get(0),this.get_node(d).get(0),e,this,h):f?this.settings.callback.oncreate.call(null,this.get_node(c).get(0),j.is("ul")?-1:this.get_node(d).get(0),e,this,h):this.settings.callback.onmove.call(null,this.get_node(c).get(0),this.get_node(d).get(0),e,this,h);return c}var l=this,k=this.moved(c.eq(0),d,e,!1,g,h);c.each(function(a){a!=0&&k&&(k=l.moved(this,k.children("a:eq(0)"),"after",!1,g,h))})}},error:function(a){this.settings.callback.error.call(null,a,this);return!1},lock:function(a){this.locked=a,this.locked?this.container.children("ul:eq(0)").addClass("locked"):this.container.children("ul:eq(0)").removeClass("locked")},cut:function(a){if(this.locked)return this.error("LOCKED");a=a?this.get_node(a):this.container.find("a.clicked").filter(":first-child").parent();if(!a||!a.size())return this.error("CUT: NO NODE SELECTED");this.copy_nodes=!1,this.cut_nodes=a},copy:function(a){if(this.locked)return this.error("LOCKED");a=a?this.get_node(a):this.container.find("a.clicked").filter(":first-child").parent();if(!a||!a.size())return this.error("COPY: NO NODE SELECTED");this.copy_nodes=a,this.cut_nodes=!1},paste:function(a,b){if(this.locked)return this.error("LOCKED");var c=!1;a==-1?(c=!0,a=this.container):a=a?this.get_node(a):this.selected;if(!c&&(!a||!a.size()))return this.error("PASTE: NO NODE SELECTED");if(!this.copy_nodes&&!this.cut_nodes)return this.error("PASTE: NOTHING TO DO");var d=this,e=b;if(b=="before")b=a.parent().children().index(a),a=a.parents("li:eq(0)");else if(b=="after")b=a.parent().children().index(a)+1,a=a.parents("li:eq(0)");else if((typeof b).toLowerCase()=="undefined"||b=="inside")b=this.settings.rules.createat=="top"?0:a.children("ul:eq(0)").children("li").size();!c&&a.size()==0&&(c=!0,a=this.container);if(this.copy_nodes&&this.copy_nodes.size()){var f=!0;if(!f)return this.error("Invalid paste");if(!c&&!this.checkMove(this.copy_nodes,a.children("a:eq(0)"),"inside"))return!1;if(a.children("ul").size()==0||c==!0&&a.children("ul").children("li").size()==0)if(!c)var g=this.moved(this.copy_nodes,a.children("a:eq(0)"),"inside",!1,!0);else var g=this.moved(this.copy_nodes,this.container.children("ul:eq(0)"),"inside",!1,!0);else if(e=="before"&&a.children("ul:eq(0)").children("li:nth-child("+(b+1)+")").size())var g=this.moved(this.copy_nodes,a.children("ul:eq(0)").children("li:nth-child("+(b+1)+")").children("a:eq(0)"),"before",!1,!0);else if(e=="after"&&a.children("ul:eq(0)").children("li:nth-child("+b+")").size())var g=this.moved(this.copy_nodes,a.children("ul:eq(0)").children("li:nth-child("+b+")").children("a:eq(0)"),"after",!1,!0);else if(a.children("ul:eq(0)").children("li:nth-child("+(b+1)+")").size())var g=this.moved(this.copy_nodes,a.children("ul:eq(0)").children("li:nth-child("+(b+1)+")").children("a:eq(0)"),"before",!1,!0);else var g=this.moved(this.copy_nodes,a.children("ul:eq(0)").children("li:last").children("a:eq(0)"),"after",!1,!0);this.copy_nodes=!1}if(this.cut_nodes&&this.cut_nodes.size()){var f=!0;a.parents().andSelf().each(function(){if(d.cut_nodes.index(this)!=-1){f=!1;return!1}});if(!f)return this.error("Invalid paste");if(!c&&!this.checkMove(this.cut_nodes,a.children("a:eq(0)"),"inside"))return!1;if(a.children("ul").size()==0||c==!0&&a.children("ul").children("li").size()==0)if(!c)var g=this.moved(this.cut_nodes,a.children("a:eq(0)"),"inside");else var g=this.moved(this.cut_nodes,this.container.children("ul:eq(0)"),"inside");else if(e=="before"&&a.children("ul:eq(0)").children("li:nth-child("+(b+1)+")").size())var g=this.moved(this.cut_nodes,a.children("ul:eq(0)").children("li:nth-child("+(b+1)+")").children("a:eq(0)"),"before");else if(e=="after"&&a.children("ul:eq(0)").children("li:nth-child("+b+")").size())var g=this.moved(this.cut_nodes,a.children("ul:eq(0)").children("li:nth-child("+b+")").children("a:eq(0)"),"after");else if(a.children("ul:eq(0)").children("li:nth-child("+(b+1)+")").size())var g=this.moved(this.cut_nodes,a.children("ul:eq(0)").children("li:nth-child("+(b+1)+")").children("a:eq(0)"),"before");else var g=this.moved(this.cut_nodes,a.children("ul:eq(0)").children("li:last").children("a:eq(0)"),"after");this.cut_nodes=!1}},search:function(b){var c=this;if(!b||this.srch&&b!=this.srch)this.srch="",this.srch_opn=!1,this.container.find("a.search").removeClass("search ui-state-highlight");this.srch=b;if(!!b)if(this.settings.data.async)if(!this.srch_opn){var d=a.extend({search:b},this.settings.data.async_data(!1,this));a.ajax({type:this.settings.data.method,url:this.settings.data.url,data:d,dataType:"text",success:function(d){c.srch_opn=a.unique(d.split(",")),c.search.apply(c,[b])}})}else if(this.srch_opn.length){if(this.srch_opn&&this.srch_opn.length){var e=!1;for(var f=0;f<this.srch_opn.length;f++)if(this.get_node("#"+this.srch_opn[f]).size()>0){e=!0;var g="#"+this.srch_opn[f];delete this.srch_opn[f],this.open_branch(g,!0,function(){c.search.apply(c,[b])})}e||(this.srch_opn=[],c.search.apply(c,[b]))}}else{var h="a";this.settings.languages.length&&(h+="."+this.current_lang),this.container.find(h+":contains('"+b+"')").addClass(this.settings.ui.theme_name=="themeroller"?"search ui-state-highlight":"search"),this.srch_opn=!1}else{var h="a";this.settings.languages.length&&(h+="."+this.current_lang),this.container.find(h+":contains('"+b+"')").addClass(this.settings.ui.theme_name=="themeroller"?"search ui-state-highlight":"search").parents("li.closed").each(function(){c.open_branch(this,!0)})}},destroy:function(){this.hide_context(),this.container.unbind(".jstree"),a("#"+this.container.attr("id")).die("click.jstree").die("dblclick.jstree").die("contextmenu.jstree").die("mouseover.jstree").die("mouseout.jstree").die("mousedown.jstree"),this.container.removeClass("tree ui-widget ui-widget-content tree-default tree-"+this.settings.ui.theme_name).children("ul").removeClass("no_dots rtl ltr locked").find("li").removeClass("leaf").removeClass("open").removeClass("closed").removeClass("last").children("a").removeClass("clicked hover search ui-state-active ui-state-hover ui-state-highlight ui-state-default");if(this.cntr==b.focused)for(var c in b.inst)if(c!=this.cntr&&c!=this.container.attr("id")){b.inst[c].focus();break}b.inst[this.cntr]=!1,b.inst[this.container.attr("id")]=!1,delete b.inst[this.cntr],delete b.inst[this.container.attr("id")],b.cntr--}}}a.fn.tree=function(c){return this.each(function(){var d=a.extend({},c);b.inst&&b.inst[a(this).attr("id")]&&b.inst[a(this).attr("id")].destroy(),d!==!1&&(new b).init(this,d)})},a.tree_create=function(){return new b},a.tree_focused=function(){return b.inst[b.focused]},a.tree_reference=function(a){return b.inst[a]||null},a.tree_rollback=function(c){for(var d in c){if(typeof c[d]=="function")continue;var e=b.inst[d],f=!e.locked;f&&e.lock(!0),e.inp&&e.inp.val("").blur(),e.context.append=!1,e.container.html(c[d].html).find(".dragged").removeClass("dragged").end().find("div.context").remove(),c[d].selected&&(e.selected=a("#"+c[d].selected),e.selected_arr=[],e.container.find("a.clicked").each(function(){e.selected_arr.push(e.get_node(this))})),f&&e.lock(!1),delete f,delete e}}})(jQuery),Sarissa.VERSION="0.9.9.4",Sarissa.PARSED_OK="Document contains no parsing errors",Sarissa.PARSED_EMPTY="Document is empty",Sarissa.PARSED_UNKNOWN_ERROR="Not well-formed or other error",Sarissa.IS_ENABLED_TRANSFORM_NODE=!1,Sarissa.REMOTE_CALL_FLAG="gr.abiss.sarissa.REMOTE_CALL_FLAG",Sarissa._lastUniqueSuffix=0,Sarissa._getUniqueSuffix=function(){return Sarissa._lastUniqueSuffix++},Sarissa._SARISSA_IEPREFIX4XSLPARAM="",Sarissa._SARISSA_HAS_DOM_IMPLEMENTATION=document.implementation&&!0,Sarissa._SARISSA_HAS_DOM_CREATE_DOCUMENT=Sarissa._SARISSA_HAS_DOM_IMPLEMENTATION&&document.implementation.createDocument,Sarissa._SARISSA_HAS_DOM_FEATURE=
Sarissa._SARISSA_HAS_DOM_IMPLEMENTATION&&document.implementation.hasFeature,Sarissa._SARISSA_IS_MOZ=Sarissa._SARISSA_HAS_DOM_CREATE_DOCUMENT&&Sarissa._SARISSA_HAS_DOM_FEATURE,Sarissa._SARISSA_IS_SAFARI=navigator.userAgent.toLowerCase().indexOf("safari")!=-1||navigator.userAgent.toLowerCase().indexOf("konqueror")!=-1,Sarissa._SARISSA_IS_SAFARI_OLD=Sarissa._SARISSA_IS_SAFARI&&parseInt((navigator.userAgent.match(/AppleWebKit\/(\d+)/)||{})[1],10)<420,Sarissa._SARISSA_IS_IE=document.all&&window.ActiveXObject&&navigator.userAgent.toLowerCase().indexOf("msie")>-1&&navigator.userAgent.toLowerCase().indexOf("opera")==-1,Sarissa._SARISSA_IS_OPERA=navigator.userAgent.toLowerCase().indexOf("opera")!=-1;if(!window.Node||!Node.ELEMENT_NODE)Node={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12};if(Sarissa._SARISSA_IS_SAFARI_OLD){HTMLHtmlElement=document.createElement("html").constructor,Node=HTMLElement={},HTMLElement.prototype=HTMLHtmlElement.__proto__.__proto__,HTMLDocument=Document=document.constructor;var x=new DOMParser;XMLDocument=x.constructor,Element=x.parseFromString("<Single />","text/xml").documentElement.constructor,x=null}typeof XMLDocument=="undefined"&&typeof Document!="undefined"&&(XMLDocument=Document);if(Sarissa._SARISSA_IS_IE){Sarissa._SARISSA_IEPREFIX4XSLPARAM="xsl:";var _SARISSA_DOM_PROGID="",_SARISSA_XMLHTTP_PROGID="",_SARISSA_DOM_XMLWRITER="";Sarissa.pickRecentProgID=function(a){var b=!1,c,d;for(var e=0;e<a.length&&!b;e++)try{var f=new ActiveXObject(a[e]);d=a[e],b=!0}catch(g){c=g}if(!b)throw"Could not retrieve a valid progID of Class: "+a[a.length-1]+". (original exception: "+c+")";a=null;return d},_SARISSA_DOM_PROGID=null,_SARISSA_THREADEDDOM_PROGID=null,_SARISSA_XSLTEMPLATE_PROGID=null,_SARISSA_XMLHTTP_PROGID=null,XMLHttpRequest=function(){_SARISSA_XMLHTTP_PROGID||(_SARISSA_XMLHTTP_PROGID=Sarissa.pickRecentProgID(["Msxml2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"]));return new ActiveXObject(_SARISSA_XMLHTTP_PROGID)},Sarissa.getDomDocument=function(a,b){_SARISSA_DOM_PROGID||(_SARISSA_DOM_PROGID=Sarissa.pickRecentProgID(["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"]));var c=new ActiveXObject(_SARISSA_DOM_PROGID);if(b){var d="";a&&(b.indexOf(":")>1?(d=b.substring(0,b.indexOf(":")),b=b.substring(b.indexOf(":")+1)):d="a"+Sarissa._getUniqueSuffix()),a?c.loadXML("<"+d+":"+b+" xmlns:"+d+'="'+a+'"'+" />"):c.loadXML("<"+b+" />")}return c},Sarissa.getParseErrorText=function(a){var b=Sarissa.PARSED_OK;if(a&&a.parseError&&a.parseError.errorCode&&a.parseError.errorCode!=0){b="XML Parsing Error: "+a.parseError.reason+"\nLocation: "+a.parseError.url+"\nLine Number "+a.parseError.line+", Column "+a.parseError.linepos+":\n"+a.parseError.srcText+"\n";for(var c=0;c<a.parseError.linepos;c++)b+="-";b+="^\n"}else a.documentElement===null&&(b=Sarissa.PARSED_EMPTY);return b},Sarissa.setXpathNamespaces=function(a,b){a.setProperty("SelectionLanguage","XPath"),a.setProperty("SelectionNamespaces",b)},XSLTProcessor=function(){_SARISSA_XSLTEMPLATE_PROGID||(_SARISSA_XSLTEMPLATE_PROGID=Sarissa.pickRecentProgID(["Msxml2.XSLTemplate.6.0","MSXML2.XSLTemplate.3.0"])),this.template=new ActiveXObject(_SARISSA_XSLTEMPLATE_PROGID),this.processor=null},XSLTProcessor.prototype.importStylesheet=function(a){_SARISSA_THREADEDDOM_PROGID||(_SARISSA_THREADEDDOM_PROGID=Sarissa.pickRecentProgID(["MSXML2.FreeThreadedDOMDocument.6.0","MSXML2.FreeThreadedDOMDocument.3.0"])),a.setProperty("SelectionLanguage","XPath"),a.setProperty("SelectionNamespaces","xmlns:xsl='http://www.w3.org/1999/XSL/Transform'");var b=new ActiveXObject(_SARISSA_THREADEDDOM_PROGID);try{b.resolveExternals=!0,b.setProperty("AllowDocumentFunction",!0)}catch(c){}a.url&&a.selectSingleNode("//xsl:*[local-name() = 'import' or local-name() = 'include']")!=null?(b.async=!1,b.load(a.url)):b.loadXML(a.xml),b.setProperty("SelectionNamespaces","xmlns:xsl='http://www.w3.org/1999/XSL/Transform'");var d=b.selectSingleNode("//xsl:output");d?this.outputMethod=d.getAttribute("method"):delete this.outputMethod,this.template.stylesheet=b,this.processor=this.template.createProcessor(),this.paramsSet=[]},XSLTProcessor.prototype.transformToDocument=function(a){var b;if(_SARISSA_THREADEDDOM_PROGID){this.processor.input=a,b=new ActiveXObject(_SARISSA_DOM_PROGID),this.processor.output=b,this.processor.transform();return b}_SARISSA_DOM_XMLWRITER||(_SARISSA_DOM_XMLWRITER=Sarissa.pickRecentProgID(["Msxml2.MXXMLWriter.6.0","Msxml2.MXXMLWriter.3.0","MSXML2.MXXMLWriter","MSXML.MXXMLWriter","Microsoft.XMLDOM"])),this.processor.input=a,b=new ActiveXObject(_SARISSA_DOM_XMLWRITER),this.processor.output=b,this.processor.transform();var c=new ActiveXObject(_SARISSA_DOM_PROGID);c.loadXML(b.output+"");return c},XSLTProcessor.prototype.transformToFragment=function(a,b){this.processor.input=a,this.processor.transform();var c=this.processor.output,d=b.createDocumentFragment(),e;if(this.outputMethod=="text")d.appendChild(b.createTextNode(c));else if(b.body&&b.body.innerHTML){e=b.createElement("div"),e.innerHTML=c;while(e.hasChildNodes())d.appendChild(e.firstChild)}else{var f=new ActiveXObject(_SARISSA_DOM_PROGID);c.substring(0,5)=="<?xml"&&(c=c.substring(c.indexOf("?>")+2));var g="".concat("<my>",c,"</my>");f.loadXML(g),e=f.documentElement;while(e.hasChildNodes())d.appendChild(e.firstChild)}return d},XSLTProcessor.prototype.setParameter=function(a,b,c){c=c?c:"",a?this.processor.addParameter(b,c,a):this.processor.addParameter(b,c),a=""+(a||""),this.paramsSet[a]||(this.paramsSet[a]=[]),this.paramsSet[a][b]=c},XSLTProcessor.prototype.getParameter=function(a,b){a=""+(a||"");return this.paramsSet[a]&&this.paramsSet[a][b]?this.paramsSet[a][b]:null},XSLTProcessor.prototype.clearParameters=function(){for(var a in this.paramsSet)for(var b in this.paramsSet[a])a!=""?this.processor.addParameter(b,"",a):this.processor.addParameter(b,"");this.paramsSet=[]}}else Sarissa._SARISSA_HAS_DOM_CREATE_DOCUMENT&&(Sarissa.__handleLoad__=function(a){Sarissa.__setReadyState__(a,4)},_sarissa_XMLDocument_onload=function(){Sarissa.__handleLoad__(this)},Sarissa.__setReadyState__=function(a,b){a.readyState=b,a.readystate=b,a.onreadystatechange!=null&&typeof a.onreadystatechange=="function"&&a.onreadystatechange()},Sarissa.getDomDocument=function(a,b){var c=document.implementation.createDocument(a?a:null,b?b:null,null);c.onreadystatechange||(c.onreadystatechange=null),c.readyState||(c.readyState=0),c.addEventListener("load",_sarissa_XMLDocument_onload,!1);return c},window.XMLDocument||(Sarissa._SARISSA_HAS_DOM_FEATURE&&window.Document&&!Document.prototype.load&&document.implementation.hasFeature("LS","3.0")?Sarissa.getDomDocument=function(a,b){var c=document.implementation.createDocument(a?a:null,b?b:null,null);return c}:Sarissa.getDomDocument=function(a,b){var c=document.implementation.createDocument(a?a:null,b?b:null,null);c&&(a||b)&&!c.documentElement&&c.appendChild(c.createElementNS(a,b));return c}));window.DOMParser||(Sarissa._SARISSA_IS_SAFARI?(DOMParser=function(){},DOMParser.prototype.parseFromString=function(a,b){var c=new XMLHttpRequest;c.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(a),!1),c.send(null);return c.responseXML}):Sarissa.getDomDocument&&Sarissa.getDomDocument()&&Sarissa.getDomDocument(null,"bar").xml&&(DOMParser=function(){},DOMParser.prototype.parseFromString=function(a,b){var c=Sarissa.getDomDocument();c.loadXML(a);return c}));if(typeof document.importNode=="undefined"&&Sarissa._SARISSA_IS_IE)try{document.importNode=function(a,b){var c;if(a.nodeName=="#text")return document.createTextNode(a.data);a.nodeName=="tbody"||a.nodeName=="tr"?c=document.createElement("table"):a.nodeName=="td"?c=document.createElement("tr"):a.nodeName=="option"?c=document.createElement("select"):c=document.createElement("div"),b?c.innerHTML=a.xml?a.xml:a.outerHTML:c.innerHTML=a.xml?a.cloneNode(!1).xml:a.cloneNode(!1).outerHTML;return c.getElementsByTagName("*")[0]}}catch(e){}Sarissa.getParseErrorText||(Sarissa.getParseErrorText=function(a){var b=Sarissa.PARSED_OK;if(!a||!a.documentElement)b=Sarissa.PARSED_EMPTY;else if(a.documentElement.tagName=="parsererror")b=a.documentElement.firstChild.data,b+="\n"+a.documentElement.firstChild.nextSibling.firstChild.data;else if(a.getElementsByTagName("parsererror").length>0){var c=a.getElementsByTagName("parsererror")[0];b=Sarissa.getText(c,!0)+"\n"}else a.parseError&&a.parseError.errorCode!=0&&(b=Sarissa.PARSED_UNKNOWN_ERROR);return b}),Sarissa.getText=function(a,b){var c="",d=a.childNodes;for(var e=0;e<d.length;e++){var f=d[e],g=f.nodeType;g==Node.TEXT_NODE||g==Node.CDATA_SECTION_NODE?c+=f.data:b===!0&&(g==Node.ELEMENT_NODE||g==Node.DOCUMENT_NODE||g==Node.DOCUMENT_FRAGMENT_NODE)&&(c+=Sarissa.getText(f,!0))}return c},!window.XMLSerializer&&Sarissa.getDomDocument&&Sarissa.getDomDocument("","foo",null).xml&&(XMLSerializer=function(){},XMLSerializer.prototype.serializeToString=function(a){return a.xml}),Sarissa.stripTags=function(a){return a?a.replace(/<[^>]+>/g,""):a},Sarissa.clearChildNodes=function(a){while(a.firstChild)a.removeChild(a.firstChild)},Sarissa.copyChildNodes=function(a,b,c){Sarissa._SARISSA_IS_SAFARI&&b.nodeType==Node.DOCUMENT_NODE&&(b=b.documentElement);if(!a||!b)throw"Both source and destination nodes must be provided";c||Sarissa.clearChildNodes(b);var d=b.nodeType==Node.DOCUMENT_NODE?b:b.ownerDocument,e=a.childNodes,f;if(typeof d.importNode!="undefined")for(f=0;f<e.length;f++)b.appendChild(d.importNode(e[f],!0));else for(f=0;f<e.length;f++)b.appendChild(e[f].cloneNode(!0))},Sarissa.moveChildNodes=function(a,b,c){if(!a||!b)throw"Both source and destination nodes must be provided";c||Sarissa.clearChildNodes(b);var d=a.childNodes;if(a.ownerDocument==b.ownerDocument)while(a.firstChild)b.appendChild(a.firstChild);else{var e=b.nodeType==Node.DOCUMENT_NODE?b:b.ownerDocument,f;if(typeof e.importNode!="undefined")for(f=0;f<d.length;f++)b.appendChild(e.importNode(d[f],!0));else for(f=0;f<d.length;f++)b.appendChild(d[f].cloneNode(!0));Sarissa.clearChildNodes(a)}},Sarissa.xmlize=function(a,b,c){c=c?c:"";var d=c+"<"+b+">",e=!1;if(!(a instanceof Object)||a instanceof Number||a instanceof String||a instanceof Boolean||a instanceof Date)d+=Sarissa.escape(""+a),e=!0;else{d+="\n";var f=a instanceof Array;for(var g in a)d+=Sarissa.xmlize(a[g],f?'array-item key="'+g+'"':g,c+"   ");d+=c}return d+=b.indexOf(" ")!=-1?"</array-item>\n":"</"+b+">\n"},Sarissa.escape=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},Sarissa.unescape=function(a){return a.replace(/&apos;/g,"'").replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&")},Sarissa.updateCursor=function(a,b){a&&a.style&&a.style.cursor!=undefined&&(a.style.cursor=b)},Sarissa.updateContentFromURI=function(a,b,c,d,e){try{Sarissa.updateCursor(b,"wait");var f=new XMLHttpRequest;f.open("GET",a,!0),f.onreadystatechange=function(){if(f.readyState==4)try{var e=f.responseXML;if(e&&Sarissa.getParseErrorText(e)==Sarissa.PARSED_OK)Sarissa.updateContentFromNode(f.responseXML,b,c),d&&d(a,b);else throw Sarissa.getParseErrorText(e)}catch(g){if(d)d(a,b,g);else throw g}};if(e){var g="Sat, 1 Jan 2000 00:00:00 GMT";f.setRequestHeader("If-Modified-Since",g)}f.send("")}catch(h){Sarissa.updateCursor(b,"auto");if(d)d(a,b,h);else throw h}},Sarissa.updateContentFromNode=function(a,b,c){try{Sarissa.updateCursor(b,"wait"),Sarissa.clearChildNodes(b);var d=a.nodeType==Node.DOCUMENT_NODE?a:a.ownerDocument;if(d.parseError&&d.parseError.errorCode!=0){var e=document.createElement("pre");e.appendChild(document.createTextNode(Sarissa.getParseErrorText(d))),b.appendChild(e)}else{c&&(a=c.transformToDocument(a));if(b.tagName.toLowerCase()=="textarea"||b.tagName.toLowerCase()=="input")b.value=(new XMLSerializer).serializeToString(a);else try{b.appendChild(b.ownerDocument.importNode(a,!0))}catch(f){b.innerHTML=(new XMLSerializer).serializeToString(a)}}}catch(f){throw f}finally{Sarissa.updateCursor(b,"auto")}},Sarissa.formToQueryString=function(a){var b="";for(var c=0;c<a.elements.length;c++){var d=a.elements[c],e=d.getAttribute("name")?d.getAttribute("name"):d.getAttribute("id");if(e&&(!d.disabled||d.type=="hidden"))switch(d.type){case"hidden":case"text":case"textarea":case"password":b+=e+"="+encodeURIComponent(d.value)+"&";break;case"select-one":b+=e+"="+encodeURIComponent(d.options[d.selectedIndex].value)+"&";break;case"select-multiple":for(var f=0;f<d.length;f++){var g=d.options[f];g.selected===!0&&(b+=e+"[]"+"="+encodeURIComponent(g.value)+"&")}break;case"checkbox":case"radio":d.checked&&(b+=e+"="+encodeURIComponent(d.value)+"&")}}return b.substr(0,b.length-1)},Sarissa.updateContentFromForm=function(a,b,c,d){try{Sarissa.updateCursor(b,"wait");var e=Sarissa.formToQueryString(a)+"&"+Sarissa.REMOTE_CALL_FLAG+"=true",f=new XMLHttpRequest,g=a.getAttribute("method")&&a.getAttribute("method").toLowerCase()=="get";g?f.open("GET",a.getAttribute("action")+"?"+e,!0):(f.open("POST",a.getAttribute("action"),!0),f.setRequestHeader("Content-type","application/x-www-form-urlencoded"),f.setRequestHeader("Content-length",e.length),f.setRequestHeader("Connection","close")),f.onreadystatechange=function(){try{if(f.readyState==4){var e=f.responseXML;if(e&&Sarissa.getParseErrorText(e)==Sarissa.PARSED_OK)Sarissa.updateContentFromNode(f.responseXML,b,c),d&&d(a,b);else throw Sarissa.getParseErrorText(e)}}catch(g){if(d)d(a,b,g);else throw g}},f.send(g?"":e)}catch(h){Sarissa.updateCursor(b,"auto");if(d)d(a,b,h);else throw h}return!1},Sarissa.FUNCTION_NAME_REGEXP=new RegExp(""),Sarissa.getFunctionName=function(a,b){var c;c||(b?(c="SarissaAnonymous"+Sarissa._getUniqueSuffix(),window[c]=a):c=null),c&&(window[c]=a);return c},Sarissa.setRemoteJsonCallback=function(a,b,c){c||(c="callback");var d=Sarissa.getFunctionName(b,!0),e="sarissa_json_script_id_"+Sarissa._getUniqueSuffix(),f=document.getElementsByTagName("head")[0],g=document.createElement("script");g.type="text/javascript",g.id=e,g.onload=function(){},a.indexOf("?")!=-1?a+="&"+c+"="+d:a+="?"+c+"="+d,g.src=a,f.appendChild(g);return e},Sarissa._SARISSA_HAS_DOM_FEATURE&&document.implementation.hasFeature("XPath","3.0")&&(SarissaNodeList=function(a){this.length=a},SarissaNodeList.prototype=[],SarissaNodeList.prototype.constructor=Array,SarissaNodeList.prototype.item=function(a){return a<0||a>=this.length?null:this[a]},SarissaNodeList.prototype.expr="",window.XMLDocument&&!XMLDocument.prototype.setProperty&&(XMLDocument.prototype.setProperty=function(a,b){}),Sarissa.setXpathNamespaces=function(a,b){a._sarissa_useCustomResolver=!0;var c=b.indexOf(" ")>-1?b.split(" "):[b];a._sarissa_xpathNamespaces=[];for(var d=0;d<c.length;d++){var e=c[d],f=e.indexOf(":"),g=e.indexOf("=");if(!(f>0&&g>f+1))throw"Bad format on namespace declaration(s) given";var h=e.substring(f+1,g),i=e.substring(g+2,e.length-1);a._sarissa_xpathNamespaces[h]=i}},XMLDocument.prototype._sarissa_useCustomResolver=!1,XMLDocument.prototype._sarissa_xpathNamespaces=[],XMLDocument.prototype.selectNodes=function(a,b,c){var d=this,e;this._sarissa_useCustomResolver?e=function(a){var b=d._sarissa_xpathNamespaces[a];if(b)return b;throw"No namespace URI found for prefix: '"+a+"'"}:e=this.createNSResolver(this.documentElement);var f=null;if(!c){var g=this.evaluate(a,b?b:this,e,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),h=new SarissaNodeList(g.snapshotLength);h.expr=a;for(var i=0;i<h.length;i++)h[i]=g.snapshotItem(i);f=h}else f=this.evaluate(a,b?b:this,e,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;return f},Element.prototype.selectNodes=function(a){var b=this.ownerDocument;if(b.selectNodes)return b.selectNodes(a,this);throw"Method selectNodes is only supported by XML Elements"},XMLDocument.prototype.selectSingleNode=function(a,b){var c=b?b:null;return this.selectNodes(a,c,!0)},Element.prototype.selectSingleNode=function(a){var b=this.ownerDocument;if(b.selectSingleNode)return b.selectSingleNode(a,this);throw"Method selectNodes is only supported by XML Elements"},Sarissa.IS_ENABLED_SELECT_NODES=!0);var xslTransform={init:function(){},XMLSerializer:new XMLSerializer,serialize:function(a){if(typeof a=="string")return a;return this.XMLSerializer.serializeToString(a)},load:function(a,b,c){var d;if(typeof a=="object")return a;a.substring(0,1)=="<"?d=this.loadString(a):d=this.loadFile(a,b,c);if(d){d.setProperty("SelectionNamespaces",'xmlns:xsl="http://www.w3.org/1999/XSL/Transform"'),d.setProperty("SelectionLanguage","XPath");return d}return!1},loadString:function(a){var b=new DOMParser,c=b.parseFromString(a,"text/xml");if(!c)return!1;return c},loadFile:function(a,b,c){if(!a)return!1;var d;this.xhrsuccess=function(a,b){d=a;return!0},this.xhrerror=function(a,b){d=null;return!1},b||(b="GET"),c||(c={}),jQuery.ajax({type:b,url:a,data:c,async:!1,success:this.xhrsuccess,error:this.xhrerror});if(!d)return!1;if(d.length==0)return!1;return d},transform:function(a,b,c){var d={xsl:a,xml:b,options:c};c=c||{};var b={request:b,doc:this.load(b,c.meth,c.dat)};if(b.doc==!1)return!1;var e={xsl:this.load(a,c.meth,c.dat)};if(e.xsl==!1)return!1;e.json=!1,c.json&&b.doc&&(e.json=b.doc.selectSingleNode(c.json.toString()));var f=new XSLTProcessor;f.importStylesheet(e.xsl);if(c.params&&f)for(key in c.params)f.setParameter(null,key.toString(),c.params[key].toString());e.doc=f.transformToDocument(b.doc);var g=Sarissa.getParseErrorText(e.doc);if(g!=Sarissa.PARSED_OK)return!1;e.string=this.serialize(e.doc),e.scripts=jQuery("script",e.doc).text();return e}};xslTransform.init(),jQuery.fn.getTransform=function(xsl,xml,options){var settings={append:!1,params:{},xpath:"",eval:!0,callback:"",error:"",json:!1,meth:"GET",dat:{}};jQuery.extend(settings,options);if(!!xsl&&!!xml){var trans=xslTransform.transform(xsl,xml,settings);if(trans==!1){settings.error&&jQuery.isFunction(settings.error)&&settings.error.apply(window,[]);return}return this.each(function(){var re=trans.string.match(/<\?xml.*?\?>/);re&&(trans.string=trans.string.replace(re,""));try{settings.append?jQuery(this).append(trans.string):settings.repl?jQuery(this).replaceWith(trans.string):jQuery(this).html(trans.string)}catch(e){jQuery(this)[0].innerHTML=trans.string}settings.eval&&trans.scripts&&trans.scripts.length>0&&eval.call(window,trans.scripts);if(settings.callback&&jQuery.isFunction(settings.callback)){var json=!1;settings.json&&trans.json&&eval("json = "+trans.json.firstChild.data),settings.callback.apply(window,[trans.string,json])}})}}